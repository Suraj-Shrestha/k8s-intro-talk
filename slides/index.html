<html>
	<head>
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/css/reveal.css">
		<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/lib/css/zenburn.css">
		<link rel="stylesheet" href="assets/robot-lung.css" />

		<title>Introduction to Kubernetes (k8s)</title>
	</head>
	<body>
		<div class="reveal">
			<div class="slides">
				
				<section data-transition="concave" data-background="xxx">
					<h2>Introduction to</h2>
					<img src="assets/kubernetes-logo.png" style="border: none; box-shadow: none;" />
					<h4>by Marie K. Ekeberg</h4>
				</section>

				<!-- TODO: put this into the resources somehow:
					 https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.15/
				   -->
				
				<section>
					<h2>Agenda</h2>

					<!-- TODO: should prereqs for learning k8s well be included?
						 TODO: slides on helm and useful tools for k8s. "Helm is the best way to find, share, and use software built for Kubernetes."
					   -->
					<ul>
						<li>What is Kubernetes (k8s)?</li>
						<li>What problems do k8s solve?</li>
						<li>k8s concepts</li>
						<li>Using kubectl</li>
						<li>Useful tools</li>
						<li>Recommended resources</li>
					</ul>
				</section>

				<section>
					<h1>Disclaimer!</h1>
					
				</section>
				
				<section>
					<h2>What is Kubernetes (k8s)?</h2>

					<ul>
						<li>Invented at Google, based on ideas from Borg</li>
						<li>Container orchestration</li>
						<lI>Infrastructure component</lI>
					</ul>
				</section>
				
				<!-- What it is used for -->
				<section>
					<section>
						<h2>What problems do k8s solve?</h2>

						<p>Solves many issues usually solved manually or by in-house tools and scripts</p>
					</section>

					<!-- Replication and failover, Scalability (both nodes and easy extension of cluster), more?
						 Resiliency (e.g, if an application is deemed unhealthy (deadlock or other failure that is not recoverable), Kubernetes can restart it for you)
						 Autoscaling of instances/pods. 

						 Mention advantages with containers in general? (e.g, that the application now contains all settings and runtime information as well)
						 
						 Easier setup? Because we don't have to setup everything ourselves?

						 Resource handling (memory/disk full etc.) - can control what is prioritized and moved to other nodes with quality of service settings. 
					   -->
					
					<section>
						<h2>Handle that a correct number of instances of a service is always available</h2>

						<p>Even when a Node in your Cluster suddenly breaks or is unavailable</p>
					</section>

					<section>
						<h2>Gradual rollouts - No downtime</h2>
					</section>

					<section>
						<h2>Security: Limiting access to containers outside the cluster</h2>
					</section>

					<section>
						<h2>Load-balancing of resources</h2>
					</section>

					<section>
						<h2>Easier infrastructure management</h2>
					</section>
				</section>

				

				<!-- Main concepts -->
				<section>
					<!-- TODO: maybe we should take some time to put yaml examples and so on here? -->

					<!-- TODO: should these be covered?
					   - labels
					   -configs for services (clusterip, loadbalancer, nodeport)
					   - DNS entries?
					   - Liveness and readiness probes?
						 Namespaces
					   -->
					
					<section>
						<h2>k8s concepts/resources</h2>

						<ul>
							<li>Nodes</li>
							<li>Pods</li>
							<li>Deployments</li>
							<li>Services</li>
							<li>...</li>
							<li>Other concepts</li>
						</ul>
					</section>

					<section>
						<h4>Nodes</h4>

						<img src="assets/cluster-node.png" style="border: none; box-shadow: none; height: 40vh" />
						
						<p>Physical or virtual machine in your cluster</p>
					</section>
					
					<section>
						<h4>Pods</h4>

						
						
						<ul>
							<li>Lowest unit in k8s</li>
							<li>Contain one or more containers</li>
							<li>Usually part of deployment config</li>
						</ul>
					</section>

					<section>
						<h4>Pods II: Probes</h4>

						<!-- TODO: find a clever way of explaining this. Should this maybe come later? -->
					</section>

					<section>
						<h4>Deployments</h4>

						<ul>
							<li>ReplicaSets</li>
							<li>Main resource for content in cluster</li>
						</ul>
					</section>

					<section>
						<h4>Deployments II: YAML config</h4>

						<pre>
							<code>
apiVersion: apps/v1
kind: Deployment
metadata:
  name: bookservice-deployment
  labels:
    app: bookservice
spec:
  replicas: 2
  selector:
    matchLabels:
      app: bookservice
  template:
    metadata:
      labels:
        app: bookservice
    spec:
      containers:
        - name: bookservice
          image: themkat/k8sintro-bookservice:1.0
          imagePullPolicy: IfNotPresent
          ports:
            - containerPort: 8080
							</code>
						</pre>
					</section>

					<!-- TODO: curiousity: What is daemonsets? Maybe? -->

					<section>
						<h4>Services</h4>

						<!-- TODO: some fun image -->
						
						<ul>
							<li>Exposing pods in deployment for access</li>
							<li>Creates DNS entries used for communication</li>
						</ul>
					</section>

					<section>
						<h4>Services II: YAML config</h4>

						<pre>
							<code>
apiVersion: v1
kind: Service
metadata:
  name: bookservice-service
spec:
  selector:
    app: bookservice
  type: ClusterIP
  ports:
    - protocol: TCP
      port: 8080
      targetPort: 8080

							</code>
						</pre>
					</section>

					<!-- TODO: Ingress? -->

					<!-- TODO: slide about NodePort vs LoadBalancer vs Ingress? -->


					<section>
						<h4>Endpoints</h4>

						<img src="assets/database.png" style="border: none; box-shadow: none; height: 40vh;" />
						
						<p>Like a deployment, but describes something outside the cluster</p>
					</section>

					<section>
						<h4>Endpoints II: YAML</h4>

						<pre>
							<code>
apiVersion: v1
kind: Endpoint
metadata:
  name: Database
subsets:
  addresses:
    - ip: 54.344.3.2
  ports:
    - port: 1540

							</code>
						</pre>
						
						<p>Like a deployment, a service is needed to expose</p>
					</section>

					<section>
						<h4>Namespaces</h4>

						<ul>
							<li>No namespace specified = Default namespace</li>
							<li>"Group" resources</li>
						</ul>
					</section>

					<section>
						<h4>Namespaces II: YAML</h4>

						<pre>
							<code>
apiVersion: v1
kind: Namespace
metadata:
  name: MyNamespace
							</code>
						</pre>

						<p>Can also be created in CLI</p>
					</section>

					<section>
						<h4>Jobs</h4>			
						
						<ul>
							<li>Batch jobs</li>
							<li>CronJob</li>
							<li>Handles restartability and more</li>
						</ul>
					</section>
					
					<!-- mention concepts not mentioned above here.. -->
					<section>
						<h2>Other concepts</h2>

						Several other concepts, which include:
						<ul>
							<li>Volumes</li>
							<li>Physical volumes / Physical volume claims</li>
							<li>ConfigMaps</li>
							<li>Secret</li>
							<li>...and more!</li>
						</ul>
					</section>

					<section>
						<h2>So many resources :(</h2>

						<p class="fragment">Most important:</p>
						<ul class="fragment">
							<li>Deployments</li>
							<li>Services</li>
						</ul>
					</section>
				</section>


				<section>
					<section>
						<h2>Using kubectl - the Kubernetes Control CLI</h2>
					</section>

					<section>
						<h4>Side-track: What CLIs are there?</h4>

						<!-- TODO: teaser? running single container? Executing commands with kubectl exec? kubectl logs? kubectl describe and so on? -->

						<!-- TODO: have a seperate section for kubectl and basic operations? Maybe after the concepts? Then we could have an explanation for each of the Kubernetes CLI tools:
						   - kubeadm - administrating nodes in your kubernetes cluster
						   - kubelet - node agent. Does operations on each node. Handles containers running in a pod. Usually not touched.
						   - kubectl - the main tool for working with your cluster (we will briefly look at this)
						   -->
						<ul>
							<li>kubeadm</li>
							<li>kubelet</li>
							<li>kubectl</li>
						</ul>
					</section>

					<section>
						<!-- TODO: do this part need to take a bigger role according to the description? -->
						<h4>Side-track II: Running locally</h4>

						<ul>
							<li>Docker Desktop</li>
							<li>Docker for Mac</li>
							<li>Minikube</li>
						</ul>
					</section>

					<section>
						<h4>Deployment and service without YAML</h4>

						<!-- TODO: make sure the commands are about right. just wrote from memory :P -->
						<pre>
							<code>
user@computername $ kubectl run --image=image:1.0 --replicas=3
# deployment created
user@computername $ kubectl expose --port= --name=imgservice --type=NodePort
							</code>
						</pre>

						<p>Not used much beyond pet/toy projects</p>
					</section>

					<section>
						Scaling deployments

						<pre>
							<code>
user@computername $ kubectl scale deployment deployment-name --replicas=6
							</code>
						</pre>
					</section>

					<section>
						Viewing resource information

						<pre>
							<code>
user@computername $ kubectl get all
user@computername $ kubectl get nodes
user@computername $ kubectl get pods
user@computername $ kubectl get deployments
user@computername $ kubectl get services
user@computername $ kubectl get services --namespace MyNamespace
user@computername $ kubectl get service service-name
user@computername $ kubectl get namespace
user@computername $ kubectl get deployment deployment-name -o yaml
							</code>
						</pre>
					</section>
					
					<section>
						Describing resources

						<pre>
							<code>
user@computername $ kubectl describe deployment deployment-name
							</code>
						</pre>

						<p>Views all information about image pull status, errors etc.</p>
					</section>
					
					<section>
						<h4>Applying YAML configs</h4>

						<pre>
							<code>
user@computername $ kubectl apply -f file.yml
user@computername $ kubectl apply -f file.yml --namespace MyNamespace
							</code>
						</pre>
					</section>
					

<!-- TODO: should the help option be mentioned? -->
				</section>


				<!-- TODO: should examples with Helm be included? maybe have multiple slides here? -->
				<section>
					<h2>Useful tools</h2>

					<ul>
						<li>Helm</li>
						
					</ul>
				</section>
				
				<section>
					<h2>Recommended resources</h2>

					<ul>
						<li>KataCoda</li>
						<li>Kubernetes for Developers by Joseph Heck</li>
						<li>Kubernetes kubectl cheatsheet</li>
						<li>Docker CLI to kubectl</li>
					</ul>

					<p>Also my github repo 4 more! ;)</p>
				</section>
			</div>
		</div>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/headjs/1.0.3/head.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/js/reveal.js"></script>
		<script>
		 Reveal.initialize({
			 dependencies: [
				 { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.6.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } }
			 ]
		 });
		</script>
	</body>
</html>
